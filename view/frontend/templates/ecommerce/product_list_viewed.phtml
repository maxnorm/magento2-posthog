<?php
/**
 * @var \Indexa\Posthog\Block\Ecommerce\ProductListViewed $block
 * PostHog ecommerce spec: "Product List Viewed" â€“ list_id, category, products[]
 */

if (!$block->shouldRender()) {
    return;
}

$payload = $block->getProductListViewedPayload();
if (empty($payload['products'])) {
    return;
}

$payloadJson = json_encode($payload, JSON_UNESCAPED_SLASHES | JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP);
?>
<script>
(function() {
    var payload = <?= /* @noEscape */ $payloadJson ?>;
    function capture() {
        if (window.posthog && window.posthog.capture) {
            window.posthog.capture('Product List Viewed', payload);
        } else {
            setTimeout(capture, 100);
        }
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', capture);
    } else {
        capture();
    }
})();
</script>
