<?php
/**
 * @var \Indexa\Posthog\Block\Ecommerce\SessionEvents $block
 */

if (!$block->shouldRender()) {
    return;
}

$productAdded = $block->getProductAddedPayload();
$productRemoved = $block->getProductRemovedPayload();
if ($productAdded === null && $productRemoved === null) {
    return;
}
?>
<script>
(function() {
    function capture() {
        if (!window.posthog || !window.posthog.capture) {
            setTimeout(capture, 100);
            return;
        }
        <?php if ($productAdded !== null): ?>
        window.posthog.capture('Product Added', <?= /* @noEscape */ json_encode($productAdded, JSON_UNESCAPED_SLASHES | JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP) ?>);
        <?php endif; ?>
        <?php if ($productRemoved !== null): ?>
        window.posthog.capture('Product Removed', <?= /* @noEscape */ json_encode($productRemoved, JSON_UNESCAPED_SLASHES | JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP) ?>);
        <?php endif; ?>
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', capture);
    } else {
        capture();
    }
})();
</script>
